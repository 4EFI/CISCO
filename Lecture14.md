# OSPF (Open Shortest Path First)

OSPF (Open Shortest Path First) является мощным и популярным протоколом маршрутизации, который активно используется в IP-сетях. Он основан на алгоритме состояния канала (LSA — Link-State Advertisement) и обеспечивает быстрое обновление маршрутов и конвергенцию сети.

## Структура OSPF: Area

### Area 0: Backbone Area

- Backbone Area: Центральная зона, к которой должны подключаться все другие зоны. Backbone играет важную роль в объединении различных зон через Area Border Routers (ABR).

### Внутренние маршрутизаторы

- Внутренний маршрутизатор (Internal Router): Размещается полностью внутри одной зоны и не пересекает её границы.

### Граничные маршрутизаторы

- ABR (Area Border Router): Этот маршрутизатор соединяет две или более зоны и обменивается маршрутами между ними и Backbone. Он играет ключевую роль в поддержании связи между разными областями сети.

- ASBR (Autonomous System Boundary Router): Маршрутизатор, находящийся на границе автономной системы, взаимодействующий с другими сетевыми системами или протоколами (например, соединение с внешними сетями через BGP).

## Типы Зон

1. Standard Zone (Стандартная зона): Обычная зона, где маршрутизаторы имеют доступ ко всем маршрутам.

2. Stub Zone (Тупиковая зона): В этой зоне количество внешних маршрутов сведено к минимуму, что обеспечивает меньшую сложность маршрутизации.

3. Totally Stub Zone (Полностью тупиковая зона): Дальнейшее упрощение, где вообще не принимаются внешние маршруты, за исключением единого маршрута по умолчанию. Это помогает дополнительно сократить таблицы маршрутизации на маршрутизаторах в зоне.

## Виды маршрутов в OSPF

1. Intra-area: Маршруты, которые находятся внутри одной зоны. Эти маршруты имеют наивысший приоритет, так как знают маршрут к действительной конечной сети.

2. Inter-area: Маршруты между зонами, передаваемые через ABR, имеют чуть меньший приоритет, так как они проходят через границы нескольких зон.

3. E1 и E2-тип: Внешние маршруты, которые получены от других ASBR. 

  - E1: Суммируют все затраты до ASBR, что обеспечивает более точное определение пути с учётом всех сегментов маршрута.
  
  - E2: Имеют постоянную стоимость независимо от внутренней сети, удобны для маршрутов, которые должны быть стабильными и предсказуемыми в многозонной среде.

## Почему гибридный протокол?

В одной зоне OSPF ведет себя к Link-State (обменивается LSA). НО гибридный между зонами. Между зонами передаются маршруты. 

## Зачем нужны зоны? 

Упростить процедуру вычисления топологии. Топологии вычисляются только в зоне. 

### Типы LSA: 

LSA (Link-State Advertisement) — это основное средство обмена информацией в протоколе маршрутизации OSPF. Маршрутизаторы используют LSA для распространения информации о состоянии своих соединений (линков) и сети в целом. 

<p style="text-align: left"><img src=res/14_1.png width="500px"/></p>

#### LSA 1-го типа (Router)

- Генерируется каждым маршрутизатором для описания состояния своих интерфейсов и линков.
- Включает уникальный идентификатор маршрутизатора и список всех подключенных интерфейсов.
- Используется для построения базы данных состояния канала **в пределах зоны**.

#### LSA 2-го типа (Network)

- Создаётся Designated Router (DR) для описания маршрутизаторов в общей сети.
- Содержит идентификатор сети и список всех маршрутизаторов на сегменте.

#### LSA 3-го типа (Summary)

- Генерируется Area Border Routers (ABR) для обмена маршрутами между зонами.
- Передаёт информацию о доступных сетях в других зонах.
- Обеспечивает связность всей сети OSPF через обмен маршрутами между зонами.

#### LSA 4-го типа

- Информирует о наличии ASBR через ABR.
- Указывает адрес и метрики до ASBR.
- Помогает маршрутизировать трафик к ASBR, откуда могут поступать внешние маршруты.

#### LSA 5-го типа (External)

- Распространяет внешние маршруты, доступные за пределами OSPF.
- Содержит информацию о маршрутах и их метрики.
- Интегрирует внешние маршруты в OSPF, обеспечивая общую маршрутизацию.

## Расчет метрики:

Метрика в OSPF определяет стоимость маршрута, и она играет ключевую роль в выборе наилучшего пути для передачи данных. В OSPF стоимость пути определяется для каждого ссылочного интерфейса и основывается на пропускной способности этого интерфейса.

### Основная формула

Метрика OSPF рассчитывается как:
```
  Метрика = (RefBW)/(RealBW)
```

- RefBW (Reference Bandwidth): Это эталонная пропускная способность, которая является основной для расчёта стоимости. По умолчанию в OSPF она равна 100 Мегабит (100 000 Кбит/с).
- RealBW (Real Bandwidth): Реальная пропускная способность интерфейса, измеренная в Кбит/с.



# Туннелирование и VPN

Туннелирование, или создание VPN (Virtual Private Network), — это метод передачи данных через межсетевые взаимодействия, обеспечивающий безопасность и изоляцию. Оно позволяет передать один сетевой протокол через другой, создавая "туннель" для данных.

## Инкапсуляция

Порядок инкапсуляции может меняться в зависимости от специфики настроек и используемых протоколов. В некоторых случаях внешний заголовок может быть добавлен первым, в других — последним. Поэтому нельзя говорить о едином фиксированном порядке — он может варьироваться в зависимости от нужд сети и целей настройки.

## Пример: IPIP (IP-in-IP) Туннелирование

IPIP — это простой способ инкапсуляции IP-пакета внутри другого IP-пакета. Его использование удобно для случаев, когда требуется передать IP-трафик, не изменяя его содержание, через данные сети.

### Сценарий: Туннелирование между роутерами R1 и R2

Рассмотрим пример использования туннеля для соединения маршрутизаторов R1 и R2, следуя шагам:

1. Создание туннеля: 
  Роутеры R1 и R2 должны установить туннельный интерфейс для взаимодействия друг с другом через IPIP метод.

2. Инкапсуляция данных: 
  Каждый пакет, отправленный через туннель, будет содержать оригинальный IP-заголовок внутри нового IP-заголовка. Внешний заголовок содержит IP-адреса маршрутизаторов R1 и R2, обеспечивая правильную маршрутизацию через основную сеть.

3. Декодирование пакетов: 
  Как только инкапсулированные пакеты достигают целевого маршрутизатора (например, R2), они "разворачиваются", удаляется внешний IP-заголовок, и внутренние данные передаются далее в сеть R2.

### Минус

Технология IPIP позволяет инкапсулировать только IP-пакеты. Если существует необходимость передачи других типов трафика (например, не-IP протоколов), необходимо создавать новый тип туннеля, так как IPIP ограничен своей простой структурой и предназначен исключительно для IP-вложений.

#### GRE (Generic Routing Encapsulation)

GRE — это более универсальная форма туннелирования, предоставляющая дополнительную гибкость при передаче различных типов пакетов через IP-сеть.

GRE позволяет инкапсулировать не только IP-пакеты, но и множество других протоколов. Это делает GRE особенно полезным в сетях, где необходимо передавать одновременно различные типы трафика, включая IPX или AppleTalk.

В отличие от IPIP, GRE добавляет дополнительный заголовок между внешним IP-заголовком и внутренним пакетом. Этот GRE-заголовок указывает тип инкапсулированного пакета и содержит информацию, необходимую для обеспечения корректной маршрутизации внутри туннеля.


## VxLAN (Virtual Extensible LAN)

VxLAN представляет собой технологию, которая предоставляет возможность передачи L2 трафика через L3 сети, расширяя возможности сетевой виртуализации.

## Поля заголовка VxLAN и их длина

<p style="text-align: left"><img src=res/14_2.png width="600px"/></p>

1. Flags (Флаги)
  - Длина: 8 бит
  - Описание: Первое поле VxLAN заголовка, предназначенное для различных флагов. Наиболее значимый бит этого поля (обычно первый) традиционно используется для обозначения действительности пакета (например, что VNI является действительным). Остальные биты часто остаются зарезервированными.

2. Reserved1 (Зарезервированное поле 1)
  - Длина: 24 бита
  - Описание: Эти биты зарезервированы для будущего использования и обычно не заполнены в стандартных реализациях.

3. VNI (Virtual Network Identifier - Идентификатор виртуальной сети)
  - Длина: 24 бита
  - Описание: Это ключевое поле, которое определяет идентификатор виртуальной сети. Оно позволяет идентифицировать до 16 миллионов сетевых сегментов, обеспечивая сильную изоляцию и масштабируемость за счёт одновременного сосуществования множества виртуальных сетей.

4. Reserved2 (Зарезервированное поле 2)
  - Длина: 8 бит
  - Описание: Как и Reserved1, это поле сохраняется для потенциальных будущих функций или стандартов. На данный момент оно не используется в большинстве приложений.

